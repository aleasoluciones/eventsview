<html>

<body>
<div>
    <form id="filtersform">
    </form>
</div>

<div>
    <ul id="warningsul">
    </ul>
</div>
<hr>
<div>
    <ul id="eventsul">
    </ul>
</div>



<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="./events.js"></script>
<script type="text/javascript">
(function() {

    function renderFilters(filters, availableFilters, selectsHandler){

        var filtersform = $("#filtersform");
        filtersform.empty();

        filters = filters || {};
        availableFilters = availableFilters || {};
        for (var property in availableFilters) {
            var label = $('<label/>', {for: property});
            label.text(property);
            label.css( {"margin-left":"10px", "margin-right":"5px"});
            var select = $('<select/>', {id: property, selected: "NA"});
            for (i=0; i< availableFilters[property].length; i++){
                select.append('<option value="' + availableFilters[property][i] + '">' + availableFilters[property][i] + '</option>');
            }
            select.append('<option value="NA">*</option>');
            select.change(function(e){
                property = $(e.target).attr('id');
                selected = $(e.target).val();
                selectsHandler(property, selected);
            });
            filtersform.append(label);
            filtersform.append(select);
        }
    };

    function renderNewEvents(events){
        events.sort(function(e1, e2) { return e2.id - e1.id; });
        var eventsul = $("#eventsul");
        eventsul.empty();

        for (var i=0; i< events.length; i++){
            var liNode = $('<li>', {id: events[i].id});
            liNode.text(events[i].id + " " + events[i].timestamp +  " " + events[i].message);
            eventsul.append(liNode);
        }
    };

    function renderNewWarningEvents(warnings){
        warnings.sort(function(e1, e2) { return e2.id - e1.id; });
        var warningsul = $("#warningsul");
        warningsul.empty();

        for (var i=0; i< warnings.length; i++){
            var liNode = $('<li>');
            var href = $('<a>', {href: "#"+warnings[i].id});
            href.text(warnings[i].id + " " + warnings[i].message);
            liNode.append(href);
            warningsul.append(liNode);
        }
    };

    var eventsService = EVENTS.createEventsService('/events');
    var eventsPresenter = EVENTS.createPresenter(
        eventsService,
        {render: renderNewEvents},
        {render: renderNewWarningEvents},
        {render: renderFilters});
    eventsPresenter.displayEvents();
})();
</script>

</body>
</html>
